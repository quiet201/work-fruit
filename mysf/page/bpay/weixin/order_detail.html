<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<title>订单详情</title>
<link rel="stylesheet" href="../weixin/css/baobeibao_weixin.css">
<link rel="stylesheet" href="../../../css/common/public.css">
<script type="text/javascript" src="/js/common/jquery-1.7.2.min.js"></script>
<script type="text/javascript">
$(document).ready(function (){
	//加日志
	$.post("/service/commonLog/addLog/L00903");
	var urlinfo=window.location.href; //获取当前页面的url 
	var len=urlinfo.length;//获取url的长度 
	var offset=urlinfo.indexOf("?");//设置参数字符串开始的位置 
	var newsidinfo=urlinfo.substr(offset,len)//取出参数字符串 这里会获得类似“id=1”这样的字符串 
	//alert(newsidinfo);
	//var newsidinfo2=newsidinfo.split("&aipayUrl=")[0];
	var newsids=newsidinfo.split("=");//对获得的参数字符串按照“=”进行分割 
	document.getElementById("orderNo").innerHTML=newsids[1].split("&")[0];
	document.getElementById("phoneNo").innerHTML=newsids[2].split("&")[0];
	document.getElementById("clientName").innerHTML=decodeURI(newsids[3].split("&")[0]);
	//document.getElementById("payAccountNo").innerHTML=newsids[4].split("&")[0];
	document.getElementById("uwPremium").innerHTML=newsids[4].split("&")[0];
	document.getElementById("vaildTime").innerHTML=decodeURI(newsids[5].split("&")[0]);
	var payType = newsids[6].split("&")[0];
	if(payType =='3'){
		payType = '微信';
	}else if(payType =='2'){
		payType = '抵用劵';
	}
	document.getElementById("paymentType").innerHTML=payType;
	//$("#aipayUrl").val(newsidinfo.split("&aipayUrl=")[1]);
});

function payOrder(){
	/* setTimeout(function() {
		location.href = $("#aipayUrl").val();
	},80); */
	var orderNo = document.getElementById("orderNo").innerHTML;
	$.ajax({
		type : "POST",
		data : {'orderNo':orderNo},
		url : "/service/bj/purchaseBj/getWxZfData",
		success : function(data) {
			//微信支付
			function onBridgeReady(){
				WeixinJSBridge.invoke(
				       'getBrandWCPayRequest', {
				    	   "appId":data.appId,//公众号名称，由商户传入     
				           "timeStamp":data.timeStamp,//时间戳，自1970年以来的秒数     
				           "nonceStr":data.nonceStr,//随机串
				           "package":data.prepayIdEX,
				           "signType":data.signType,//微信签名方式：     
				           "paySign":data.paySign//微信签名
				       },
				       function(res){
				    	   //使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
				           if(res.err_msg == "get_brand_wcpay_request:ok" ){
				        	  // location.href = "http://ccwpyang.ngrok.natapp.cn/page/bpay/weixin/baobeibao.html?openId="+$("#openId").val();
				        	   location.href = "/page/bpay/weixin/baobeibao.html?openId="+data.openId;
				           }
				       }
				   );
				}
			
				if (typeof WeixinJSBridge == "undefined"){
				   if( document.addEventListener ){
				       document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
				   }else if (document.attachEvent){
				       document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
				       document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
				   }
				}else{
				   onBridgeReady();
				}
		},
		error : function(e) {
			console.log("操作失败...");
			getCommonImg("113","N","3");
		}
	});
}
</script>
</head>

<body>
	<div id="wrapper">

    <!-- header s -->
    <header>
        <span class="btn-topl">
        <a class="ui-btn btn-back" href="javascript: history.go(-1);"><i class="ui-ico-sfi ico-back"></i></a></span>
        <h1>订单详情</h1>
        </span>
    </header>
	</div>
	<section class="ui-list border-top0">
		<dl class="contacts sent">
			<dt>手机号码：<span id="phoneNo">136****1234</span></dt>
			<dd>订单状态：<span class="colorred">待付款</span></dd>
		</dl>
		<dl style="padding: 10px 0;">
			<span>服务介绍：对于顺丰承运的包裹，发现遗失时，每票快件赔付500元，累计赔付10000元；因顺丰公司导致的破损，每票快件赔付100元，累计赔付2000元。</span>
		</dl>
	</section>
	<section class="grid-main ui-list" style="padding: 10px 3%;">
	    <dl class="detailtext">
	    	<p>订单号：<span id="orderNo">2105062389237</span></p>
	    </dl>		
	    <dl class="detailtext">
	    	<p>姓名：<span id="clientName">张小花</span></p>
	    </dl>
	    <dl class="detailtext">
	    	<p>付款方式：<span id="paymentType">zfb</span></p>
	    </dl>			
	    <dl class="detailtext">
	    	<p>付款金额：¥<span id="uwPremium">9.9</span></p>
	    </dl>
	    <dl class="detailtext">
	    	<p>付款截止日期：<span id="vaildTime">2015.8.25  12:00</span></p>
	    </dl>
	</section>
	<dl class="bottom02">
    	<center><a class="btn-submit" onclick="payOrder()">立即付款</a></center>
    </dl>
    <script type="text/javascript" src="/js/common/baiduState.js"></script>
	</body>
</html>
