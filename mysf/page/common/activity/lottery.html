<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <title></title>
    <link rel="stylesheet" href="../../../../css/common/activity.css">
    <link rel="stylesheet" href="../../../../css/common/tips.css"/>
    <link rel="stylesheet" href="../../../../css/common/public.css">
    <script type="text/javascript" src="/js/common/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="/js/common/activity/scroll.js"></script>
    <script type="text/javascript" src="/js/common/util/util.js"></script>
        <script type="text/javascript" src="/js/baiduState.js"></script> 

</head>
<body>
	<div class="lottery">
	    <img  id="luckResult" src="/image/common/lottery.jpg">
	    <div class="lotterydiv">
	    	<a class="lot-submit" href="javascript:void(0);" onclick="luckDraw();">立即抽奖</a>
	    </div>
	</div>
	<div class="box">
	<div class="bcon">
		<h1><b>时间</b><b style="width: 85px;text-align: center;">用户</b><b style="float: right;width: 135px; text-align: center;">奖品</b></h1>
		
		<div class="list_lh">
			<ul id="ulPrizeUserList">
				
			</ul>
		</div>		
	</div>	
</div>
<div class="maskbox" id="reward" hidden="hidden">
<div class="reward">
	<img src="/image/common/reward.png" id="submitPrizeAddressPrize">
	<div class="rewarddiv"><a id="submitPrizeAddress" class="red-submit" href="index.html">领取奖品</a></div>
</div>
</div>
<div class="maskbox" id="noreward" hidden="hidden">
<div class="noreward">
	<img src="/image/common/noreward.png">
	<div class="norewarddiv"><a class="nored-submit" onclick="noreward()" >关闭</a></div>
</div>
</div>

<div class="pop-tips" hidden="true" id="errorMsg">
    <div class="tips">
    	<img src="../../../css/common/img/warning.png"><p id="errorInfo"></p>
    </div>
    </div>
    
    <div class="pop-tips" hidden="true" id="success">
    <div class="tips">
    	<img src="../../../css/common/img/success.png"><p id="MsgInfo"></p>
    </div>
</div>

<script type="text/javascript">
var bno=getUrlValueByKey("bno");
var operStatus=getUrlValueByKey("operStatus");
var id=getUrlValueByKey("id");
var activityId=getUrlValueByKey("activityId");
var prizeShowPhoneUrl=getUrlValueByKey("prizeShowPhoneUrl");
$(document).ready(function(){
	$('.list_lh li:even').addClass('lieven');
	//operStatus 1为已中奖，中将页面弹出已中奖 2 没有参与抽奖，页面弹出抽奖
	if(operStatus=="1"){
		$('#submitPrizeAddress').attr("href","/page/common/activity/award.html?id="+id);
		if(prizeShowPhoneUrl!=""){
			$('#submitPrizeAddressPrize').attr("src",prizeShowPhoneUrl);
		}	
		$('#reward').show();
	}
	$.ajax({
		type : "POST",
		dataType : "json",
		data:{		
			activityId:activityId
		},
		url : "/service/activity/selectCcwActivityUserJoinListByActivityId",
		contentType: 'application/x-www-form-urlencoded; charset=utf-8',
		success: function(json){
			var data=json;
			if(data!=null){
				var innerHtml="";
				for(var i=0;i<data.length;i++)
				{
					var o=data[i];
				    innerHtml=innerHtml+"<li><p><a>"+o.prizeDate+"</a><a class='btn_lh'>"+o.userMobile+"</a><em>"+o.prizeName+"</em></p></li>";				
				}
				$("#ulPrizeUserList").html(innerHtml);
				$("div.list_lh").myScroll({
					speed:40, 
					rowHeight:68 
				});
			}
		},
		error:function(XMLHttpRequest, textStatus, errorThrown){
			
		}
	});
});

function showDiv(){
		if($('#reward').is(':hidden')){
			$('#reward').show();
		}else{
			$('#reward').hide();
		}
}



function luckDraw(){
	
	//1为已抽奖 2为已中奖
    //$.cookie(bno, "1"); 
	if(bno!=""){
		$.ajax({
			type : "POST",
			dataType : "json",
			data:{
				bNo: bno,
				activityId:activityId
			},
			url : "/service/activity/doLuckDrawCore.action",
			contentType: 'application/x-www-form-urlencoded; charset=utf-8',
			success: function(json){
				var data=json;
				if(data.resultCode=="1"){
					//$.cookie(bno, "2"); 
					$('#submitPrizeAddress').attr("href","/page/common/activity/award.html?id="+data.ccwActivityPrizeLuck.jionId);
					if(data.ccwActivityPrizeLuck!=null&&data.ccwActivityPrizeLuck.prizeShowPhoneUrl!=""){
						$('#submitPrizeAddressPrize').attr("src","/"+data.ccwActivityPrizeLuck.prizeShowPhoneUrl);
					}					
					$('#reward').show(); //showDiv();
				}else if(data.resultCode=="5"){
					$('#noreward').show();
				}else if(data.resultCode=="3"){
					alertError(data.resultMsg);
				}else{
					alertError("非法操作");
				}
			},
			error:function(XMLHttpRequest, textStatus, errorThrown){
				
			}
		});
	}else{
		alertError("非法操作");
	}
}
function noreward(){
	history.go(-1);
}
function alertSuccess(contect){
	$('#MsgInfo').text(contect);
	$('#success').show();
	setTimeout(function () {
		$('#success').fadeOut(500);
	}, 3000);
}

function alertError(contect){
	$('#errorInfo').text(contect);
	$('#errorMsg').show();
	setTimeout(function () {
		$('#errorMsg').fadeOut(500);
	}, 3000);
}
</script>
</body>

</html>