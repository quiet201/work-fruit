<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<title>顺丰速运</title>
<link rel="stylesheet" href="../../../css/common/public.css">
<link rel="stylesheet" href="../../../css/common/sf09.css">
<link rel="stylesheet" href="../../../css/common/tips.css">
<!--<link rel="stylesheet" href="css/sc/alipay/sf02.css">-->
</head>
	<body>
		<div id="wrapper">

    <!-- header s -->
    <header>
    	<span class="btn-topl"><a class="ui-btn btn-back" href="javascript: history.go(-1);"><i class="ui-ico-sfi ico-back"></i></a></span>
        <h1>消息提醒设置</h1>
    </header>
    
    <section class="grid-main">
    	<form>
    	<ul class="ui-fm">
    		
            <li class="item item-fm">
                <div class="ui-flex">
                    <div class="flex-ico"><label><span class="lable-fontStyle">物流消息提醒</span></label></div>
                    <div class="flex-con">
                        <input id="checkbox_c2" class="chk_3" name="state"  type="checkbox" onclick="showDiv()"><label for="checkbox_c2"></label>
                    </div>
                </div>
            </li>
            
        </ul>
        </form>
        
    </section>
    <!--  <section class="grid-main">
    	<form>
    	<ul class="">
    		
            <li class="item item-fm">
               <a href="/service/activity/questionnaire.html?channel=1"><img src="../../../../image/alipay/investigation.jpg" style="width:100%"></a>
            </li>
            
        </ul>
        </form>
        
    </section> -->
    <div class="tip-box1" id="reasonDiv" hidden="true" style="margin-top:24px">
   	<h2>您关闭物流消息提醒的原因是</h2>
    <div class="tip-content">
    	           <p>
                    	<a href="javascript:void(0);" data-btn="yes-no" onclick="makeSureClick('1');">
                    	<i class="ui-ico-sfi ico-box" id="makeSure1"></i>
	        			<!--  <i class="ui-ico-sfi ico-yes2" ></i>-->
	        			
                    	<span class="text-fontStyle3 text-margin-left-6">消息推送太频繁</span>
                    	</a>
                    </p>
                    <p>
                    	<a href="javascript:void(0);" data-btn="yes-no" onclick="makeSureClick('2');">
                    	<i class="ui-ico-sfi ico-box" id="makeSure2"></i>
	        			<!--  <i class="ui-ico-sfi ico-yes2" ></i>-->
	        			
                    	<span class="text-fontStyle3 text-margin-left-6">推送错误的物流消息</span>
                    	</a>
                    </p>
                    <p>
                    	<a href="javascript:void(0);" data-btn="yes-no" onclick="makeSureClick('3');">
                    	<i class="ui-ico-sfi ico-box" id="makeSure3"></i>
	        			<!--  <i class="ui-ico-sfi ico-yes2" ></i>-->
	        			
                    	<span class="text-fontStyle3 text-margin-left-6">物流消息提醒不及时</span>
                    	</a>
                    </p>
                    <p>
                    	<a href="javascript:void(0);" data-btn="yes-no" onclick="makeSureClick('4');">
                    	<i class="ui-ico-sfi ico-box" id="makeSure4"></i>
	        			<!--  <i class="ui-ico-sfi ico-yes2" ></i>-->
	        			
                    	<span class="text-fontStyle3 text-margin-left-6">已订阅其他的物流消息提醒</span>
                    	</a>
                    </p>
                    <p>
                    	<a href="javascript:void(0);" data-btn="yes-no" onclick="makeSureClick('5');">
                    	<i class="ui-ico-sfi ico-box" id="makeSure5"></i>
	        			<!--  <i class="ui-ico-sfi ico-yes2" ></i>-->
	        			
                    	<span class="text-fontStyle3 text-margin-left-6">其他原因</span>
                    	</a>
                    </p>
    </div>
    <div class="tip-btn">
        	<span class="tip-btn-a1" href="javascript:void(0);">
				<div class="tip-btn-a-div" onclick="validtionParamAndSubmit();">确定</div>
        	</span>
        	
    </div>
</div>
<div class="pop-tips" hidden="true" id="errorMsg">
    <div class="tips">
    	<img src="../../../css/common/img/warning.png"><p id="errorInfo">请至少选择一项</p>
    </div>
    </div>
</div>
<!-- <a href="/page/alipay/index.html" class="cd-Home"><span class="ui-ico-sfi ico-home"></span></a> -->
 
	</body>
	<script type="text/javascript" src="/js/common/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="/js/common/baiduState.js"></script>
	<script type="text/javascript">
		function showDiv(){
			var isTrue=$("input[name='state']").attr("checked");
			if(isTrue){
				$('#reasonDiv').hide();
				$("input[name='state']").val("ON");
				selectOpen();
			}else{
				$('#reasonDiv').show();
				$("input[name='state']").val("OFF");
			}
			
			/* if($('#reasonDiv').is(':hidden')){
				
			}else{
				
			} */
		};
	$(function(){
		//加日志
		$.post("/service/commonLog/addLog/L00603");
		$.ajax({
			type : "GET",
			url : "/service/customset/getState",
			success: function(data){
				var obj=eval(data);
				//获取状态后并赋值
				$("input[name='state']").val(obj.state);
				 var state=$("input[name='state']").val();
				if(state=="ON"){
					$("input[name='state']").attr("checked",true);
				}else{
					$("input[name='state']").attr("checked",false);
				} 
				$('#reasonDiv').hide();
			},
			error:function(XMLHttpRequest, textStatus, errorThrown){
				alert("服务器连接失败");
			}
		}); 
	});
	
	function makeSureClick(index){
		var item = '#makeSure'+index;
		var makeSure = $(item).attr('class');
		
		if('ui-ico-sfi ico-box'==makeSure){
			//$('#makeSure').attr('class','ui-ico-sfi ico-yes2');
			$(item).attr('class','ui-ico-sfi ico-yes2');
			//$(item).parent().parent().siblings().hide();
		}else{
			//$('#makeSure').attr('class','ui-ico-sfi ico-box');
			$(item).attr('class','ui-ico-sfi ico-box');
			//$(item).parent().parent().siblings().show();
		}
		
	}
	function selectOpen(){
		var state = $("input[name='state']").val();
		if(state=="ON"){
			$.ajax({
				type : "GET",
				data : {"state":state},
				dataType : "json",
				url : "/service/customset/selectOpen"
			});
		}
	}
	
	function validtionParamAndSubmit(){
		var isTrue=$(".tip-content i").hasClass("ico-yes2");
		var state = $("input[name='state']").val();
		var reason="";
		 if(isTrue==true){
			 $(".tip-btn-a1").attr("href","");
			 $.each($(".tip-content .ui-ico-sfi.ico-yes2"),function(index,value){	
				reason+=$(this).parent().parent().find("span").text()+";";
			});
			
			var params={
					"state":state,
					"reason":reason
			};
			
			 $.ajax({
					type : "POST",
					dataType : "json",
					data : params,
					url : "/service/customset/insertReason",
					success: function(code){
						location.reload();
					},
					error:function(XMLHttpRequest, textStatus, errorThrown){
						alert("服务器连接失败");
					}
				});
		}else{
			alertError();
			
			return false;
		} 
	}
	
	function alertError(contect){
		$('#errorInfo').text(contect);
		$('#errorMsg').show();
		setTimeout(function () {
			$('#errorMsg').fadeOut(500);
		}, 2000);
	}

	
	</script>
	
</html>
