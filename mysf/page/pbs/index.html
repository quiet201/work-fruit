<!DOCTYPE html>
<html>
 <head> 
  <meta charset="utf-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" /> 
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" /> 
  <meta http-equiv="Pragma" content="no-cache" /> 
  <meta http-equiv="Expires" content="0" /> 
  <title>顺丰PBS横扫幸福</title> 
  <link rel="stylesheet" href="css/public.css" /> 
  <link rel="stylesheet" href="css/index.css" /> 
 </head> 
 <body>
  <div class="maskbox n" id="onParticipate"> 
   <div class="service-tel-box"> 
    <div class="service-tel"> 
     <h2><span class="vl33">&nbsp;</span><span class="vc33 fz14">&nbsp;</span> <a class="vr33" id="onParticipateClose"><i class="close-pay">&nbsp;</i></a></h2> 
     <p>您购物的商家未加入PBS顺丰服务保障 或未参与横扫幸福活动</p> 
     <a href="#" class="ui-btn btn-green1">此运单号不能参与活动</a> 
    </div> 
   </div> 
  </div>
  <div class="wrap"> 
   <div class="header"> 
    <div class="bg-header"> 
     <div class="msg_dhbox">
      <input class="msg_dh" id="waycode"  type="text" maxlength="12" name="msg_dh" placeholder="请输入您收到包裹的12位运单号" /> 
     </div>
     <div class="num-wrong fz13" id="errorMesg"></div>
     <section id="button" class="cc"> 
      <button class="duijiang" id="awardBtn" type="button" disabled="disabled">兑奖</button> 
     </section>
    </div> 
    <div class="c"> 
     <div class="code-er">&nbsp;</div> 
    </div> 
   
   </div> 
   
   
   
    <div class="c"> 
     <div class="footer-index"><img src="img/footer_home.png"></div> 
    </div> 
  </div>
  <script type="text/javascript" src="js/jhope.min.js"></script>
  <script type="text/javascript" src="/js/baiduState.js"></script>
  <script type="text/javascript">
		$(function(){
			$.ajax({isLoding:false,type: 'GET',url: '/service/pbs/insertPBSLog',data: {opertype:1}});
			
			$("#onParticipateClose").tap(function(){
				$("#onParticipate").addClass("n");
			});
			
			var isCourierNo = /^[0-9]{12}$/,
			$awardBtn = $('#awardBtn'),
			$waycode = $('#waycode'),
			$errorMesg = $('#errorMesg');
			$waycode.bind('input propertychange',function(){
				if($waycode.val()){
					$awardBtn.removeAttr('disabled');
					$awardBtn.addClass('duijiang-submit');
					$errorMesg.html('');
				}else{
					$awardBtn.attr('disabled',true);
					$awardBtn.removeClass('duijiang-submit');
				}
			});
			
			$awardBtn.tap(function(e){
				if(this.disabled){
					return;
				}
				$awardBtn.attr('disabled',true);
				$awardBtn.removeClass('duijiang-submit');
				if(!isCourierNo.test($waycode.val())){
					$errorMesg.html('你输入的快递单号位数不对,请重新输入');
					return;
				}
				
				$.ajax({isLoding:false,type: 'GET',url: '/service/pbs/insertPBSLog',data: {opertype:2}});
				
				$.ajax({
				  type: 'GET',
				  url: '/service/pbs/forward/drawAward',
				  data: {waycode:$waycode.val()},
				  dataType: 'json',
				  contentType: 'application/json',
				  context: $('body'),
				  success: function(data){
					  var d = data;
					  if(d==null){
						  $("#onParticipate").removeClass("n");
						  $awardBtn.removeAttr('disabled');
						  $awardBtn.addClass('duijiang-submit');
					  }else{
						  if(d['goodsDto']){
							  JHope.Tool.forwardHref('brought.html',d['goodsDto']);
						  }else{
							  JHope.Tool.forwardHref(d['activeurl'],data);
						  } 
					  }
				  }
				});
			});
		});
	</script>   
 </body>
</html>